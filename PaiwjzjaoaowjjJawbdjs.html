<!DOCTYPE html>
<html>
<head>
  <script>
    const now = Date.now();
    const minWait = 2 * 60 * 1000;    // 2 minutes
    const maxWait = 30 * 60 * 1000;   // 30 minutes

    const urlParams = new URLSearchParams(window.location.search);
    const fromLootlabs = urlParams.get('from') === 'lootlabs';

    if (fromLootlabs) {
      localStorage.setItem("lastLootlabsAccess", now.toString());
    }

    function getIDAndRedirect() {
      fetch("https://raw.githubusercontent.com/MADNESSTEST/need/main/new.txt")
        .then(response => response.text())
        .then(id => {
          const redirectURL = "https://gist.githubusercontent.com/MADNESSTEST/d79fc2de8ea72154953a21b769a4be1c/raw/" + id + "/key";
          window.location.replace(redirectURL);
        })
        .catch(error => {
          document.body.innerHTML = "<h1 style='color:red; text-align:center;'>❌ Error loading key.</h1>";
        });
    }

    window.onload = () => {
      const lastAccess = parseInt(localStorage.getItem("lastLootlabsAccess"));

      if (!lastAccess) {
        // ❌ No record: send to LootLabs
        window.location.href = "https://loot-link.com/s?XtizPfMG";
        return;
      }

      const elapsed = now - lastAccess;

      if (elapsed >= minWait && elapsed <= maxWait) {
        // ✅ Within allowed window
        getIDAndRedirect();
      } else if (elapsed < minWait) {
        // ⏳ Too early
        const secondsLeft = Math.ceil((minWait - elapsed) / 1000);
        document.body.innerHTML = `<h1 style='color:orange; text-align:center;'>⏱️ Too early! Wait ${secondsLeft} more seconds.</h1>`;
      } else {
        // ⏲️ Too late
        localStorage.removeItem("lastLootlabsAccess");
        window.location.href = "https://loot-link.com/s?XtizPfMG";
      }
    };
  </script>
</head>
<body>
</body>
</html>
